---
import Layout from "../layouts/Layout.astro";
import pb from "../utils/pb";
import { Collections, type SvgsResponse } from "../utils/pocketbase-types";
import { ui } from "../i18n/ui.js";

const locale = (Astro.locals.lang as 'en' | 'fr') ?? 'en';

// Récupère l'utilisateur connecté
const user = Astro.locals.user;

// Si l'utilisateur n'est pas connecté, rediriger vers la page de connexion
if (!user) {
  return Astro.redirect("/login");
}

// Récupère uniquement les SVGs créés par l'utilisateur connecté
const svgs = await pb
  .collection(Collections.Svgs)
  .getFullList({
    sort: "-created", // Trie les SVGs du plus récent au plus ancien
    filter: `user = "${user.id}"`, // Filtre pour n'afficher que les SVGs de l'utilisateur
  });
---

<Layout>
  <h1>{ui[locale].mySvgs.title}</h1>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    {svgs.map((svg: SvgsResponse) => (
      <div class="card bg-base-100 shadow-xl p-4">
        <h2 class="text-lg font-bold">{svg.name}</h2>
        <div class="border p-2 mt-2" set:html={svg.code}></div>
        <a href={`/gallery/${svg.id}`} class="btn btn-primary mt-4">{ui[locale].mySvgs.viewDetails}</a>
      </div>
    ))}
  </div>
</Layout>
